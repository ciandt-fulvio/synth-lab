#!/bin/bash
#
# Git pre-push hook: runs fast anti-regression tests before pushing
# Runs: smoke + contract + schema validation (~30s)
#

set -e

echo "üß™ Running fast anti-regression tests before push..."
echo ""

# Run fast test suite (smoke + contract + schema)
if ! make test-fast; then
    echo ""
    echo "‚ùå Pre-push tests failed!"
    echo "   Fix all failing tests before pushing."
    echo ""
    echo "   What failed:"
    echo "   - Smoke tests: Health checks (DB, configs, imports)"
    echo "   - Contract tests: API schemas that frontend expects"
    echo "   - Schema tests: DB schema vs SQLAlchemy models"
    echo ""
    echo "   To run full test suite: make test-full"
    echo "   To bypass this check (not recommended): git push --no-verify"
    echo ""
    exit 1
fi

echo ""
echo "‚úÖ All fast tests passed! Safe to push."
echo "   (Full test suite will run in CI)"
echo ""
