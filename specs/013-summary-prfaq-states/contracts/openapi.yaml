openapi: 3.1.0
info:
  title: Synth-Lab Artifact State API
  version: 1.0.0
  description: API contracts for summary and PR-FAQ state management

paths:
  /research/{exec_id}/artifacts:
    get:
      summary: Get artifact states for execution
      description: Returns the current state of all artifacts (summary, PR-FAQ) for a research execution
      operationId: getArtifactStates
      tags:
        - Research
      parameters:
        - name: exec_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Research execution ID
      responses:
        '200':
          description: Artifact states retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ArtifactStatesResponse'
        '404':
          description: Execution not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /prfaq/generate:
    post:
      summary: Generate PR-FAQ from research summary
      description: |
        Initiates PR-FAQ generation for a research execution.
        Returns current state if generation is already in progress.
        Fails if summary is not available.
      operationId: generatePrfaq
      tags:
        - PR-FAQ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PRFAQGenerateRequest'
      responses:
        '200':
          description: PR-FAQ generation initiated or already complete
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PRFAQGenerateResponse'
        '400':
          description: Prerequisite not met (summary not available)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Execution not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Generation already in progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PRFAQGenerateResponse'

components:
  schemas:
    ArtifactStateEnum:
      type: string
      enum:
        - unavailable
        - generating
        - available
        - failed
      description: Current state of an artifact

    ArtifactState:
      type: object
      required:
        - artifact_type
        - state
        - can_generate
        - can_view
        - prerequisite_met
      properties:
        artifact_type:
          type: string
          enum:
            - summary
            - prfaq
          description: Type of artifact
        state:
          $ref: '#/components/schemas/ArtifactStateEnum'
        can_generate:
          type: boolean
          description: Whether generate action is available
        can_view:
          type: boolean
          description: Whether view action is available
        prerequisite_met:
          type: boolean
          description: Whether prerequisites are satisfied
        prerequisite_message:
          type: string
          nullable: true
          description: Message if prerequisite not met
          example: "Summary necessario para gerar PR-FAQ"
        error_message:
          type: string
          nullable: true
          description: Last error message if failed
        started_at:
          type: string
          format: date-time
          nullable: true
          description: Generation start timestamp
        completed_at:
          type: string
          format: date-time
          nullable: true
          description: Generation completion timestamp

    ArtifactStatesResponse:
      type: object
      required:
        - exec_id
        - summary
        - prfaq
      properties:
        exec_id:
          type: string
          format: uuid
          description: Research execution ID
        summary:
          $ref: '#/components/schemas/ArtifactState'
        prfaq:
          $ref: '#/components/schemas/ArtifactState'

    PRFAQGenerateRequest:
      type: object
      required:
        - exec_id
      properties:
        exec_id:
          type: string
          format: uuid
          description: Research execution ID
        model:
          type: string
          default: gpt-4o-mini
          description: LLM model to use for generation

    PRFAQGenerateResponse:
      type: object
      required:
        - exec_id
        - status
      properties:
        exec_id:
          type: string
          format: uuid
          description: Research execution ID
        status:
          type: string
          enum:
            - generating
            - completed
            - failed
          description: Current generation status
        message:
          type: string
          description: Status message
          example: "PR-FAQ generation started"
        generated_at:
          type: string
          format: date-time
          nullable: true
          description: Completion timestamp if completed
        error_message:
          type: string
          nullable: true
          description: Error message if failed

    ErrorResponse:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: Error code
          example: SUMMARY_NOT_FOUND
        message:
          type: string
          description: Human-readable error message
          example: "Summary not found for execution"
        details:
          type: object
          additionalProperties: true
          description: Additional error details
