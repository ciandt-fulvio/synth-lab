# Quick Start Guide: listsynth

**Feature**: 003-synth-query
**Version**: 1.0.0
**Last Updated**: 2025-12-15

## Overview

The `listsynth` command lets you query and explore synthetic data generated by synth-lab. It uses DuckDB for fast SQL queries and displays results in beautiful formatted tables.

---

## Installation

### Prerequisites

- Python 3.13 or higher
- synth-lab installed
- Synthetic data generated (see "First-Time Setup")

### Install Dependencies

The query feature requires DuckDB and Typer (added automatically):

```bash
# From project root
uv pip install -e .
```

This installs:
- `duckdb>=0.9.0` - SQL query engine
- `typer>=0.9.0` - CLI framework
- `rich>=13.0.0` - Table formatting (already installed)

---

## First-Time Setup

Before using `listsynth`, you need synthetic data:

```bash
# Generate synthetic data
synthlab generate --count 100

# Verify data file exists
ls -lh data/synths/synths.json
```

You should see: `data/synths/synths.json` (file size depends on count).

---

## Basic Usage

### View All Records

Display all synthetic data:

```bash
synthlab listsynth
```

**Output**:
```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
│                 Query Results                   │
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ id          │ name       │ age │ city         │
├─────────────┼────────────┼─────┼──────────────┤
│ uuid-abc... │ João Silva │ 34  │ São Paulo    │
│ uuid-def... │ Maria Lima │ 28  │ Rio de Janeiro│
│ ...         │ ...        │ ... │ ...          │
└─────────────┴────────────┴─────┴──────────────┘

100 rows returned
```

---

## Filtering Data (--where)

### Simple Filters

Filter by age:

```bash
synthlab listsynth --where "age > 30"
```

Filter by city:

```bash
synthlab listsynth --where "city = 'São Paulo'"
```

**Important**: Use **single quotes** for string values!

### Complex Filters

Combine multiple conditions:

```bash
# Age between 25 and 40
synthlab listsynth --where "age BETWEEN 25 AND 40"

# Multiple conditions
synthlab listsynth --where "age > 30 AND city = 'Rio de Janeiro'"

# Either condition
synthlab listsynth --where "city = 'São Paulo' OR city = 'Belo Horizonte'"

# Pattern matching
synthlab listsynth --where "name LIKE 'João%'"
```

### Common Filter Examples

**People over 50**:
```bash
synthlab listsynth --where "age >= 50"
```

**Specific cities**:
```bash
synthlab listsynth --where "city IN ('São Paulo', 'Rio de Janeiro', 'Brasília')"
```

**High openness trait** (psychographics):
```bash
synthlab listsynth --where "psychographics.openness > 0.7"
```

**Gender filter**:
```bash
synthlab listsynth --where "gender = 'F'"
```

---

## Custom SQL Queries (--full-query)

### Aggregations

Count by city:

```bash
synthlab listsynth --full-query "SELECT city, COUNT(*) as total FROM synths GROUP BY city ORDER BY total DESC"
```

**Output**:
```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
│        Query Results           │
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ city            │ total        │
├─────────────────┼──────────────┤
│ São Paulo       │ 35           │
│ Rio de Janeiro  │ 28           │
│ Belo Horizonte  │ 22           │
│ Brasília        │ 15           │
└─────────────────┴──────────────┘

4 rows returned
```

Average age by gender:

```bash
synthlab listsynth --full-query "SELECT gender, AVG(age) as avg_age, COUNT(*) as count FROM synths GROUP BY gender"
```

### Selecting Specific Columns

Show only names and ages:

```bash
synthlab listsynth --full-query "SELECT name, age FROM synths ORDER BY age DESC"
```

Top 10 oldest people:

```bash
synthlab listsynth --full-query "SELECT name, age, city FROM synths ORDER BY age DESC LIMIT 10"
```

### Analytics Queries

Personality traits by age group:

```bash
synthlab listsynth --full-query "
    SELECT
        CASE
            WHEN age < 25 THEN '18-24'
            WHEN age < 35 THEN '25-34'
            WHEN age < 50 THEN '35-49'
            ELSE '50+'
        END as age_group,
        AVG(psychographics.openness) as avg_openness,
        AVG(psychographics.extraversion) as avg_extraversion,
        COUNT(*) as count
    FROM synths
    GROUP BY age_group
    ORDER BY age_group
"
```

Demographic distribution:

```bash
synthlab listsynth --full-query "
    SELECT
        state,
        gender,
        COUNT(*) as count,
        AVG(age) as avg_age
    FROM synths
    GROUP BY state, gender
    ORDER BY state, gender
"
```

---

## Common Use Cases

### 1. Data Exploration

**See what data looks like**:
```bash
# First 10 records
synthlab listsynth --full-query "SELECT * FROM synths LIMIT 10"

# Random sample
synthlab listsynth --full-query "SELECT * FROM synths ORDER BY RANDOM() LIMIT 20"
```

**Count records**:
```bash
synthlab listsynth --full-query "SELECT COUNT(*) as total_records FROM synths"
```

**See all columns**:
```bash
synthlab listsynth --full-query "SELECT * FROM synths LIMIT 1"
```

### 2. Quality Checks

**Check for duplicates**:
```bash
synthlab listsynth --full-query "SELECT name, COUNT(*) as count FROM synths GROUP BY name HAVING COUNT(*) > 1"
```

**Age distribution**:
```bash
synthlab listsynth --full-query "SELECT MIN(age) as min_age, MAX(age) as max_age, AVG(age) as avg_age FROM synths"
```

**Missing data check** (example):
```bash
synthlab listsynth --where "name IS NULL OR age IS NULL"
```

### 3. Segmentation

**High-value segment** (example using custom criteria):
```bash
synthlab listsynth --where "age BETWEEN 30 AND 50 AND psychographics.conscientiousness > 0.6"
```

**Early adopter profile**:
```bash
synthlab listsynth --where "age < 35 AND psychographics.openness > 0.7"
```

### 4. Reporting

**Summary statistics**:
```bash
synthlab listsynth --full-query "
    SELECT
        COUNT(*) as total,
        COUNT(DISTINCT city) as unique_cities,
        AVG(age) as avg_age,
        MIN(age) as min_age,
        MAX(age) as max_age
    FROM synths
"
```

---

## Tips & Tricks

### Handling Long Results

If you get a truncation warning:

```
Warning: Showing first 1,000 of 5,432 rows
```

Use `LIMIT` to control result size:

```bash
synthlab listsynth --full-query "SELECT * FROM synths ORDER BY age DESC LIMIT 50"
```

### String Values

Always use **single quotes** in SQL:

```bash
# ✅ Correct
synthlab listsynth --where "city = 'São Paulo'"

# ❌ Wrong (will fail)
synthlab listsynth --where "city = \"São Paulo\""
synthlab listsynth --where 'city = "São Paulo"'
```

### Escaping Shell Characters

If your query has special shell characters, use quotes:

```bash
# Use single quotes around entire parameter
synthlab listsynth --where 'age > 30 AND name LIKE "João%"'

# Or escape with backslash
synthlab listsynth --where "age > 30 AND name LIKE \"João%\""
```

### Performance

For very large datasets (100k+ records):

```bash
# Add LIMIT to queries
synthlab listsynth --full-query "SELECT * FROM synths WHERE age > 30 LIMIT 1000"

# Use aggregations instead of raw data
synthlab listsynth --full-query "SELECT city, COUNT(*) FROM synths GROUP BY city"
```

---

## Troubleshooting

### "Synth data file not found"

```
Error: Synth data file not found: data/synths/synths.json
Tip: Run 'synthlab generate' to create synthetic data first
```

**Solution**: Generate data first:
```bash
synthlab generate --count 100
```

### "Invalid SQL syntax"

```
Error: Invalid SQL syntax in your query
Details: Parser error: syntax error at or near ">"
```

**Common causes**:
- Missing quotes around strings: `city = São Paulo` should be `city = 'São Paulo'`
- Incomplete condition: `age >` should be `age > 30`
- Extra WHERE keyword: `--where "WHERE age > 30"` should be `--where "age > 30"`

**Solution**: Check SQL syntax, ensure strings have quotes.

### "Column not found"

```
Error: Column not found in query
Details: Column 'invalidcolumn' does not exist
```

**Solution**: Check available columns:
```bash
synthlab listsynth --full-query "SELECT * FROM synths LIMIT 1"
```

### "Cannot use both --where and --full-query"

```
Error: Cannot use both --where and --full-query
```

**Solution**: Choose one approach:
```bash
# Use --where for simple filters
synthlab listsynth --where "age > 30"

# OR use --full-query for complex queries
synthlab listsynth --full-query "SELECT * FROM synths WHERE age > 30"
```

---

## Examples Gallery

### Data Validation

```bash
# Check age range
synthlab listsynth --full-query "SELECT MIN(age), MAX(age), AVG(age) FROM synths"

# Check gender distribution
synthlab listsynth --full-query "SELECT gender, COUNT(*) FROM synths GROUP BY gender"

# Check city distribution
synthlab listsynth --full-query "SELECT city, COUNT(*) as count FROM synths GROUP BY city ORDER BY count DESC"
```

### Demographics Analysis

```bash
# Age groups
synthlab listsynth --full-query "
    SELECT
        CASE
            WHEN age < 20 THEN 'Teens'
            WHEN age < 30 THEN '20s'
            WHEN age < 40 THEN '30s'
            WHEN age < 50 THEN '40s'
            ELSE '50+'
        END as age_bracket,
        COUNT(*) as count
    FROM synths
    GROUP BY age_bracket
    ORDER BY age_bracket
"

# Geographic distribution
synthlab listsynth --full-query "SELECT state, COUNT(*) as count FROM synths GROUP BY state ORDER BY count DESC"
```

### Psychographics Analysis

```bash
# High openness individuals
synthlab listsynth --where "psychographics.openness > 0.8"

# Personality extremes
synthlab listsynth --full-query "
    SELECT name, age, city,
           psychographics.openness,
           psychographics.extraversion
    FROM synths
    WHERE psychographics.openness > 0.9
       OR psychographics.extraversion > 0.9
    ORDER BY psychographics.openness DESC
"

# Average traits by city
synthlab listsynth --full-query "
    SELECT city,
           AVG(psychographics.openness) as avg_openness,
           AVG(psychographics.conscientiousness) as avg_conscientiousness,
           COUNT(*) as count
    FROM synths
    GROUP BY city
    ORDER BY count DESC
"
```

---

## Next Steps

### Export Results

Currently, `listsynth` displays results in the terminal. For exporting to files, use shell redirection:

```bash
# Save output to file (includes table formatting)
synthlab listsynth > results.txt

# For CSV export, use SQL
synthlab listsynth --full-query "COPY (SELECT * FROM synths) TO 'output.csv' (HEADER, DELIMITER ',')"
```

### Advanced DuckDB Features

DuckDB supports advanced SQL features:

- **Window Functions**: `ROW_NUMBER()`, `RANK()`, etc.
- **CTEs (Common Table Expressions)**: `WITH ... AS (...)`
- **JSON Functions**: If synths have nested JSON
- **Date Functions**: `DATE_PART()`, `DATE_DIFF()`, etc.

Explore more at: https://duckdb.org/docs/sql/introduction

### Learn SQL

For SQL syntax help:
- DuckDB Documentation: https://duckdb.org/docs/
- SQL Tutorial: https://www.w3schools.com/sql/
- SQL Cheat Sheet: https://www.sqltutorial.org/sql-cheat-sheet/

---

## Getting Help

```bash
# View command help
synthlab listsynth --help

# View main CLI help
synthlab --help
```

For issues or questions, check the project documentation or open an issue on GitHub.
